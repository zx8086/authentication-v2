[
  {
    "label": "kong: status",
    "command": "curl -sf http://localhost:8001/status | jq .",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: list services",
    "command": "curl -sf http://localhost:8001/services | jq .",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: list routes",
    "command": "curl -sf http://localhost:8001/routes | jq .",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: list plugins",
    "command": "curl -sf http://localhost:8001/plugins | jq .",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: sync config (decK)",
    "command": "deck gateway sync kong/kong.yml --kong-addr http://localhost:8001",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: dump config (decK)",
    "command": "deck gateway dump --kong-addr http://localhost:8001 | jq .",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: diff config (decK)",
    "command": "deck gateway diff kong/kong.yml --kong-addr http://localhost:8001",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "kong: view logs",
    "command": "docker logs -f $(docker ps --filter 'name=kong' --filter 'ancestor=kong/kong-gateway:3.9' -q | head -1)",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "kong: restart",
    "command": "docker restart $(docker ps --filter 'name=kong' --filter 'ancestor=kong/kong-gateway:3.9' -q | head -1) && echo '[OK] Kong restarted'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: ping",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli ping",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: monitor (live commands)",
    "command": "docker exec -it $(docker ps --filter 'name=redis' -q | head -1) redis-cli monitor",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "redis: info stats",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli info stats",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: keys (all)",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli keys '*'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: flush all",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli flushall && echo '[OK] Redis flushed'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: interactive CLI",
    "command": "docker exec -it $(docker ps --filter 'name=redis' -q | head -1) redis-cli",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "redis: start (standalone)",
    "command": "docker run -d --name auth-redis -p 6379:6379 --restart unless-stopped redis:7-alpine redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru && echo '[OK] Redis started on localhost:6379'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: stop",
    "command": "docker stop auth-redis 2>/dev/null && echo '[OK] Redis stopped' || echo '[INFO] Redis not running'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: remove",
    "command": "docker rm auth-redis 2>/dev/null && echo '[OK] Redis container removed' || echo '[INFO] No container to remove'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: restart (standalone)",
    "command": "docker stop auth-redis 2>/dev/null; docker rm auth-redis 2>/dev/null; docker run -d --name auth-redis -p 6379:6379 --restart unless-stopped redis:7-alpine redis-server --appendonly yes --maxmemory 128mb --maxmemory-policy allkeys-lru && echo '[OK] Redis restarted on localhost:6379'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: logs",
    "command": "docker logs -f auth-redis",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "redis: status",
    "command": "docker ps --filter name=auth-redis --format 'table {{.Names}}\\t{{.Status}}\\t{{.Ports}}' || docker ps --filter 'name=redis' --format 'table {{.Names}}\\t{{.Status}}\\t{{.Ports}}'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: bigkeys",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli --bigkeys",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: memkeys",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli --memkeys",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "redis: scan auth keys",
    "command": "docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli --scan --pattern '*auth_service*'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "postgres: interactive psql",
    "command": "docker exec -it $(docker ps --filter 'name=kong-db' -q | head -1) psql -U kong -d kong",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "postgres: list tables",
    "command": "docker exec $(docker ps --filter 'name=kong-db' -q | head -1) psql -U kong -d kong -c '\\dt'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "postgres: kong services (SQL)",
    "command": "docker exec $(docker ps --filter 'name=kong-db' -q | head -1) psql -U kong -d kong -c 'SELECT id, name, host, port, protocol FROM services;'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "postgres: kong routes (SQL)",
    "command": "docker exec $(docker ps --filter 'name=kong-db' -q | head -1) psql -U kong -d kong -c 'SELECT id, name, paths, service_id FROM routes;'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "postgres: db size",
    "command": "docker exec $(docker ps --filter 'name=kong-db' -q | head -1) psql -U kong -d kong -c \"SELECT pg_size_pretty(pg_database_size('kong'));\"",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "infra: status check",
    "command": "echo '--- Kong ---' && curl -sf http://localhost:8001/status > /dev/null && echo '[OK] Kong OK' || echo '[FAIL] Kong DOWN'; echo '--- Redis ---' && docker exec $(docker ps --filter 'name=redis' -q | head -1) redis-cli ping || echo '[FAIL] Redis DOWN'; echo '--- Postgres ---' && docker exec $(docker ps --filter 'name=kong-db' -q | head -1) pg_isready -U kong > /dev/null && echo '[OK] Postgres OK' || echo '[FAIL] Postgres DOWN'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "devcontainer: up",
    "command": "docker compose -f .devcontainer/docker-compose.yml up -d && echo '[OK] Devcontainer started'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "devcontainer: down",
    "command": "docker compose -f .devcontainer/docker-compose.yml down && echo '[OK] Devcontainer stopped'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "devcontainer: down (clean volumes)",
    "command": "docker compose -f .devcontainer/docker-compose.yml down -v && echo '[OK] Devcontainer stopped and volumes removed'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "devcontainer: logs",
    "command": "docker compose -f .devcontainer/docker-compose.yml logs -f",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "devcontainer: status",
    "command": "docker compose -f .devcontainer/docker-compose.yml ps",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "dev: start (watch mode)",
    "command": "bun --watch src/index.ts",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "dev: start (devcontainer env)",
    "command": "bun --env-file=.env.devcontainer run dev",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "dev: clean restart",
    "command": "lsof -ti :3000 | xargs kill -9 2>/dev/null || true; bun --watch src/index.ts",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "dev: quickstart",
    "command": "lsof -ti :3000 | xargs kill -9 2>/dev/null || true; bun scripts/generate-openapi.ts && bun --watch src/index.ts",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "server: kill (port 3000)",
    "command": "lsof -ti :3000 | xargs kill -9 2>/dev/null && echo '[OK] Process on port 3000 killed' || echo '[INFO] No process on port 3000'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "server: health check",
    "command": "curl -sf http://localhost:3000/health | jq . && echo '[OK] Server healthy' || echo '[FAIL] Server not responding'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "test: e2e (direct)",
    "command": "bunx playwright test",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "test: e2e (via Kong)",
    "command": "API_BASE_URL=http://localhost:8000 E2E_HOST_HEADER=auth.local bunx playwright test",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "test: e2e UI",
    "command": "bunx playwright test --ui",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "test: bun (all)",
    "command": "bun test",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "test: bun (watch)",
    "command": "bun test --watch",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "test: k6 smoke (quick)",
    "command": "bun run test:k6:quick",
    "use_new_terminal": true,
    "allow_concurrent_runs": false,
  },
  {
    "label": "quality: check (all)",
    "command": "bun run quality:check",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "quality: fix",
    "command": "bun run quality:fix",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "docs: generate OpenAPI",
    "command": "bun scripts/generate-openapi.ts && echo '[OK] OpenAPI spec generated'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "github: security alerts (code scanning)",
    "command": "gh api repos/:owner/:repo/code-scanning/alerts --jq '.[] | {rule: .rule.id, severity: .rule.security_severity_level, state: .state, tool: .tool.name, file: .most_recent_instance.location.path}' | head -50",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "github: security alerts (Dependabot)",
    "command": "gh api repos/:owner/:repo/dependabot/alerts --jq '.[] | {package: .dependency.package.name, severity: .security_advisory.severity, state: .state, cve: .security_advisory.cve_id}' | head -50",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "github: docker security (Trivy)",
    "command": "gh run list --workflow=build-and-deploy.yml --limit=1 --json databaseId,conclusion -q '.[0].databaseId' | xargs -I{} gh run view {} --log | grep -E '(CRITICAL|HIGH|MEDIUM|CVE-)' | head -100",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "github: latest workflow run",
    "command": "gh run list --workflow=build-and-deploy.yml --limit=5 --json databaseId,displayTitle,conclusion,createdAt -q '.[] | \"\\(.createdAt) [\\(.conclusion)] \\(.displayTitle)\"'",
    "use_new_terminal": false,
    "reveal": "always",
  },
  {
    "label": "github: workflow artifacts",
    "command": "gh run list --workflow=build-and-deploy.yml --limit=1 --json databaseId -q '.[0].databaseId' | xargs -I{} gh api repos/:owner/:repo/actions/runs/{}/artifacts --jq '.artifacts[] | {name: .name, size: .size_in_bytes, expires: .expires_at}'",
    "use_new_terminal": false,
    "reveal": "always",
  },
]
